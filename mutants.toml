# cargo-mutants configuration
#
# Four scopes:
#   1. Safety-critical engine code — torque limits, fault detection, emergency stop
#   2. FFB / filter / pipeline crates — force feedback calculations, torque filtering
#   3. HID protocol encoding — all crates with encode functions (wrong encoding = wrong torque)
#   4. Safety infrastructure — watchdogs, RT scheduling, atomic counters
#
# Run all:          cargo mutants
# Run engine only:  cargo mutants --package racing-wheel-engine
# Run HID only:     cargo mutants --package 'racing-wheel-hid-*'
#
# Tip: set CARGO_TARGET_DIR to an isolated directory for mutation runs to
#      avoid rebuilding your main target dir.

[packages]
include = [
    # --- Safety-critical core ---
    # Torque clamping, fault detection, emergency stop, safety interlocks
    "racing-wheel-engine",
    # Force feedback effect calculations
    "openracing-ffb",
    # Torque filter pipeline (damper, friction, inertia, slew-rate limiting)
    "openracing-filters",
    # Failure-mode and effects analysis, fault recovery
    "openracing-fmea",
    # RT pipeline compilation and execution
    "openracing-pipeline",

    # --- Safety infrastructure (watchdogs, RT scheduling, lock-free counters) ---
    # Hardware watchdog state machine (arm/disarm/timeout transitions)
    "openracing-hardware-watchdog",
    # Plugin execution watchdog, fault detection, quarantine
    "openracing-watchdog",
    # Real-time 1 kHz scheduler, PLL drift correction, jitter tracking
    "openracing-scheduler",
    # Lock-free atomic counters used on the RT path for safety event metrics
    "openracing-atomic",

    # --- HID protocol encoding (wrong bytes = wrong torque on hardware) ---
    "racing-wheel-hid-moza-protocol",
    "racing-wheel-hid-cammus-protocol",
    "racing-wheel-hid-fanatec-protocol",
    "racing-wheel-hid-ffbeast-protocol",
    "racing-wheel-hid-logitech-protocol",
    "racing-wheel-hid-openffboard-protocol",
    "racing-wheel-hid-simagic-protocol",
    "racing-wheel-hid-thrustmaster-protocol",
    "racing-wheel-hid-vrs-protocol",
    "racing-wheel-hid-leo-bodnar-protocol",
    # Asetek — torque encoding + input parsing
    "hid-asetek-protocol",
    # Simucube — dual-report torque encoding + PID effects
    "hid-simucube-protocol",
    # Heusinkveld — pedal input parsing (braking safety)
    "hid-heusinkveld-protocol",

    # --- Supporting crates ---
    "racing-wheel-ks",
    "racing-wheel-input-maps",
]

# Skip trivial, auto-generated, and test-only code
exclude_globs = [
    "crates/integration-tests/**",
    "crates/schemas/**",
    "crates/telemetry-*/**",
    "crates/service/**",
    "crates/openracing-test-helpers/**",
    "workspace-hack/**",
    "benches/**",
    "**/target/**",
    "**/build.rs",
    "fuzz/**",
]

# --- Timeout tuning ---
# RT tests finish quickly, so the multiplier can be modest.  The minimum
# prevents false positives when a single test is sub-second.
timeout_multiplier = 3.0
minimum_test_timeout = 20

# --- Parallelism ---
# Leave unset to auto-detect from CPU count.  Override with --jobs=N on CI.

# Skip mutants in test-only code and pure boilerplate
exclude_re = [
    "#\\[test\\]",
    "#\\[cfg\\(test\\)\\]",
    # Debug / Display fmt — not safety-relevant
    "fn fmt\\(&self",
    # Derived serde boilerplate
    "fn serialize<",
    "fn deserialize<",
    # Clone boilerplate
    "fn clone\\(&self\\)",
    # Trivial trait delegations
    "fn as_ref\\(&self\\)",
    "fn deref\\(&self\\)",
]
